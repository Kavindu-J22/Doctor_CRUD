<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Doctors - Doctor Registration System</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link th:href="@{/css/style.css}" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" th:href="@{/doctors/list}">
                <i class="fas fa-user-md me-2"></i>
                Doctor Registration System
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" th:href="@{/doctors/list}">
                            <i class="fas fa-list me-1"></i>All Doctors
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" th:href="@{/doctors/new}">
                            <i class="fas fa-plus me-1"></i>Add Doctor
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mt-4">
        <!-- Success Message -->
        <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle me-2"></i>
            <span th:text="${successMessage}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- Error Message -->
        <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-circle me-2"></i>
            <span th:text="${errorMessage}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- Page Header -->
        <div class="row mb-4">
            <div class="col-md-6">
                <h1 class="h2">
                    <i class="fas fa-users text-primary me-2"></i>
                    All Doctors
                </h1>
                <p class="text-muted">Total: <span th:text="${totalCount}">0</span> doctors registered</p>
            </div>
            <div class="col-md-6 text-end">
                <a th:href="@{/doctors/new}" class="btn btn-primary btn-lg">
                    <i class="fas fa-plus me-2"></i>Add New Doctor
                </a>
            </div>
        </div>

        <!-- Enhanced Search Section -->
        <div class="search-container fade-in">
            <div class="row align-items-center mb-3">
                <div class="col-md-6">
                    <h5 class="mb-0 search-filter-title">
                        <i class="fas fa-search text-primary me-2"></i>
                        Search & Filter Doctors
                    </h5>
                </div>
                <div class="col-md-6 text-end">
                    <small class="filter-help-text">
                        <i class="fas fa-info-circle me-1"></i>
                        Use filters to find doctors quickly
                    </small>
                </div>
            </div>

            <form th:action="@{/doctors/search}" method="get" class="row g-3" id="searchForm">
                <!-- Main Search Input -->
                <div class="col-md-5">
                    <div class="search-input">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="form-control" name="query"
                               th:value="${searchQuery}"
                               placeholder="Search by name, email, or phone..."
                               id="searchInput">
                    </div>
                </div>

                <!-- Search Type Filter -->
                <div class="col-md-3">
                    <select class="form-select" name="type" id="searchType">
                        <option value="name" th:selected="${searchType == 'name'}">
                            <i class="fas fa-user"></i> By Name
                        </option>
                        <option value="specialization" th:selected="${searchType == 'specialization'}">
                            <i class="fas fa-stethoscope"></i> By Specialization
                        </option>
                        <option value="hospital" th:selected="${searchType == 'hospital'}">
                            <i class="fas fa-hospital"></i> By Hospital/Clinic
                        </option>
                    </select>
                </div>

                <!-- Action Buttons -->
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100" id="searchBtn">
                        <i class="fas fa-search me-1"></i>Search
                    </button>
                </div>
                <div class="col-md-2">
                    <a th:href="@{/doctors/list}" class="btn btn-outline-secondary w-100">
                        <i class="fas fa-times me-1"></i>Clear
                    </a>
                </div>
            </form>

            <!-- Search Results Info -->
            <div th:if="${searchQuery != null and !searchQuery.isEmpty()}" class="mt-3">
                <div class="filter-tags">
                    <span class="filter-tag">
                        <i class="fas fa-filter me-1"></i>
                        <span th:text="'Searching for: ' + ${searchQuery}"></span>
                        <i class="fas fa-times remove-tag" onclick="clearSearch()"></i>
                    </span>
                    <span class="filter-tag" th:if="${searchType != 'name'}">
                        <i class="fas fa-tag me-1"></i>
                        <span th:text="'Type: ' + ${searchType}"></span>
                    </span>
                </div>
            </div>
        </div>

        <!-- Enhanced Doctors Table -->
        <div class="card slide-up">
            <div class="card-header d-flex justify-content-between align-items-center">
                <div>
                    <h5 class="mb-0 text-dark">
                        <i class="fas fa-users text-primary me-2"></i>
                        Registered Doctors
                    </h5>
                    <small class="text-secondary">
                        <span th:text="${totalCount}">0</span> doctors found
                        <span th:if="${searchQuery != null and !searchQuery.isEmpty()}"
                              th:text="' for \'' + ${searchQuery} + '\''"></span>
                    </small>
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-outline-secondary" onclick="toggleView()" id="viewToggle">
                        <i class="fas fa-th-large me-1"></i>Card View
                    </button>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button"
                                data-bs-toggle="dropdown">
                            <i class="fas fa-sort me-1"></i>Sort
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" onclick="sortTable('name')">
                                <i class="fas fa-sort-alpha-down me-2"></i>Name A-Z</a></li>
                            <li><a class="dropdown-item" href="#" onclick="sortTable('specialization')">
                                <i class="fas fa-stethoscope me-2"></i>Specialization</a></li>
                            <li><a class="dropdown-item" href="#" onclick="sortTable('experience')">
                                <i class="fas fa-calendar me-2"></i>Experience</a></li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="card-body">
                <!-- Empty State -->
                <div th:if="${doctors.empty}" class="empty-state">
                    <div class="empty-state-icon">
                        <i class="fas fa-user-md"></i>
                    </div>
                    <h4 class="text-light">No doctors found</h4>
                    <p th:if="${searchQuery == null or searchQuery.isEmpty()}" class="text-light">
                        Start by adding your first doctor to the system.
                    </p>
                    <p th:if="${searchQuery != null and !searchQuery.isEmpty()}" class="text-light">
                        No doctors match your search criteria. Try adjusting your search terms.
                    </p>
                    <div class="mt-3">
                        <a th:href="@{/doctors/new}" class="btn btn-primary me-2">
                            <i class="fas fa-plus me-2"></i>Add First Doctor
                        </a>
                        <a th:if="${searchQuery != null and !searchQuery.isEmpty()}"
                           th:href="@{/doctors/list}" class="btn btn-outline-secondary">
                            <i class="fas fa-times me-2"></i>Clear Search
                        </a>
                    </div>
                </div>

                <!-- Table View -->
                <div th:if="${!doctors.empty}" class="table-responsive" id="tableView">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th class="sortable" data-sort="name">
                                    <i class="fas fa-user me-1"></i>Name
                                    <i class="fas fa-sort sort-icon"></i>
                                </th>
                                <th>
                                    <i class="fas fa-envelope me-1"></i>Email
                                </th>
                                <th>
                                    <i class="fas fa-phone me-1"></i>Phone
                                </th>
                                <th class="sortable" data-sort="specialization">
                                    <i class="fas fa-stethoscope me-1"></i>Specialization
                                    <i class="fas fa-sort sort-icon"></i>
                                </th>
                                <th class="sortable" data-sort="experience">
                                    <i class="fas fa-calendar me-1"></i>Experience
                                    <i class="fas fa-sort sort-icon"></i>
                                </th>
                                <th>
                                    <i class="fas fa-hospital me-1"></i>Hospital/Clinic
                                </th>
                                <th class="text-center">
                                    <i class="fas fa-cogs me-1"></i>Actions
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="doctor : ${doctors}" class="fade-in">
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="avatar-circle me-2">
                                            <i class="fas fa-user-md"></i>
                                        </div>
                                        <div>
                                            <strong th:text="'Dr. ' + ${doctor.firstName} + ' ' + ${doctor.lastName}">
                                                Dr. John Doe
                                            </strong>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <a th:href="'mailto:' + ${doctor.email}" class="text-decoration-none">
                                        <span th:text="${doctor.email}">john.doe@email.com</span>
                                    </a>
                                </td>
                                <td>
                                    <a th:href="'tel:' + ${doctor.phoneNumber}" class="text-decoration-none">
                                        <span th:text="${doctor.phoneNumber}">+1234567890</span>
                                    </a>
                                </td>
                                <td>
                                    <span class="badge bg-info" th:text="${doctor.specialization}">Cardiology</span>
                                </td>
                                <td>
                                    <span class="experience-badge" th:text="${doctor.yearsOfExperience} + ' years'">
                                        5 years
                                    </span>
                                </td>
                                <td th:text="${doctor.hospitalClinic}">City Hospital</td>
                                <td>
                                    <div class="btn-group" role="group">
                                        <a th:href="@{/doctors/view/{id}(id=${doctor.id})}"
                                           class="btn btn-sm btn-outline-primary"
                                           title="View Details"
                                           data-bs-toggle="tooltip">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a th:href="@{/doctors/edit/{id}(id=${doctor.id})}"
                                           class="btn btn-sm btn-outline-warning"
                                           title="Edit Doctor"
                                           data-bs-toggle="tooltip">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <a th:href="@{/doctors/delete/{id}(id=${doctor.id})}"
                                           class="btn btn-sm btn-outline-danger"
                                           title="Delete Doctor"
                                           data-bs-toggle="tooltip"
                                           onclick="return confirmDelete()">
                                            <i class="fas fa-trash"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-light text-center text-muted py-3 mt-5">
        <div class="container">
            <p>&copy; 2024 Doctor Registration System. All rights reserved.</p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Enhanced JavaScript -->
    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize tooltips
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });

            // Auto-hide alerts after 5 seconds
            setTimeout(function() {
                var alerts = document.querySelectorAll('.alert');
                alerts.forEach(function(alert) {
                    var bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();
                });
            }, 5000);

            // Add fade-in animation to table rows
            const rows = document.querySelectorAll('tbody tr');
            rows.forEach((row, index) => {
                row.style.animationDelay = `${index * 0.1}s`;
            });

            // Real-time search functionality
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                let searchTimeout;
                searchInput.addEventListener('input', function() {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        if (this.value.length >= 2 || this.value.length === 0) {
                            performSearch();
                        }
                    }, 500);
                });
            }
        });

        // Enhanced delete confirmation
        function confirmDelete() {
            return Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this action!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#ef4444',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Yes, delete it!',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                return result.isConfirmed;
            });
        }

        // Clear search function
        function clearSearch() {
            window.location.href = '/doctors/list';
        }

        // Toggle between table and card view
        function toggleView() {
            const tableView = document.getElementById('tableView');
            const cardView = document.getElementById('cardView');
            const toggleBtn = document.getElementById('viewToggle');

            if (tableView.style.display === 'none') {
                tableView.style.display = 'block';
                if (cardView) cardView.style.display = 'none';
                toggleBtn.innerHTML = '<i class="fas fa-th-large me-1"></i>Card View';
            } else {
                tableView.style.display = 'none';
                if (cardView) cardView.style.display = 'block';
                toggleBtn.innerHTML = '<i class="fas fa-table me-1"></i>Table View';
            }
        }

        // Sort table functionality
        function sortTable(column) {
            const table = document.querySelector('.table tbody');
            const rows = Array.from(table.querySelectorAll('tr'));

            rows.sort((a, b) => {
                let aVal, bVal;

                switch(column) {
                    case 'name':
                        aVal = a.cells[0].textContent.trim();
                        bVal = b.cells[0].textContent.trim();
                        break;
                    case 'specialization':
                        aVal = a.cells[3].textContent.trim();
                        bVal = b.cells[3].textContent.trim();
                        break;
                    case 'experience':
                        aVal = parseInt(a.cells[4].textContent.match(/\d+/)[0]);
                        bVal = parseInt(b.cells[4].textContent.match(/\d+/)[0]);
                        break;
                    default:
                        return 0;
                }

                if (column === 'experience') {
                    return bVal - aVal; // Descending for experience
                } else {
                    return aVal.localeCompare(bVal); // Ascending for text
                }
            });

            // Clear table and re-append sorted rows
            table.innerHTML = '';
            rows.forEach(row => table.appendChild(row));

            // Update sort icons
            document.querySelectorAll('.sort-icon').forEach(icon => {
                icon.className = 'fas fa-sort sort-icon';
            });

            const sortedHeader = document.querySelector(`[data-sort="${column}"] .sort-icon`);
            if (sortedHeader) {
                sortedHeader.className = 'fas fa-sort-up sort-icon';
            }
        }

        // Perform search with loading state
        function performSearch() {
            const searchBtn = document.getElementById('searchBtn');
            const originalText = searchBtn.innerHTML;

            // Show loading state
            searchBtn.innerHTML = '<span class="loading-spinner me-1"></span>Searching...';
            searchBtn.disabled = true;

            // Submit form
            setTimeout(() => {
                document.getElementById('searchForm').submit();
            }, 300);
        }

        // Add hover effects to table rows
        document.addEventListener('DOMContentLoaded', function() {
            const tableRows = document.querySelectorAll('tbody tr');
            tableRows.forEach(row => {
                row.addEventListener('mouseenter', function() {
                    this.style.transform = 'scale(1.01)';
                });

                row.addEventListener('mouseleave', function() {
                    this.style.transform = 'scale(1)';
                });
            });
        });
    </script>

    <!-- SweetAlert2 for better modals -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>
</html>
